<h1>New prize</h1>

<%= error_messages_for :prize %>

<% form_for(@prize) do |f| %>
	
	<%= f.hidden_field 'prizearea' %>
	<%= hidden_field_tag 'center_lat' %>
	<%= hidden_field_tag 'center_lng' %>
	<%= f.text_field :name %>

  <p>    
  		 <%= submit_tag "Create2", :onclick=> 'doStuffBeforeSubmit();' %>
  </p>
<% end %>

<%= link_to 'Back', prizes_path %>
  
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Google Maps JavaScript API Example</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA6RZP3ZouLBJsRfEv4s3jzhT2yXp_ZAY8_ufC3CFXhHIE1NvwkxT6qAbsBjBmEKqdpIQq_13niSn_-Q"
      type="text/javascript"></script>
      <script>
       var map = null;
    	var geocoder = null;
    	var prizearea = null;

	function whereami()
      {   
       alert(map.getBounds());
       alert(map.getCenter());  
      }
      
      function doStuffBeforeSubmit()
      {
      var arrTempPrizeArea=new Array();
      for (var x=0;x<prizearea.getVertexCount();x++){
      	var latlng = prizearea.getVertex(x);
    		arrTempPrizeArea.push(latlng.lat()+","+latlng.lng());
		}
		
		strTempGeo = arrTempPrizeArea.join(":")
	 	document.getElementById("prize_prizearea").value = strTempGeo;
	 	document.getElementById("center_lat").value = map.getCenter().lat();
	 	document.getElementById("center_lng").value = map.getCenter().lng();
  }
    function whereistheprizearea()
    {
    	//alert(prizearea.getBounds())
    	//alert(prizearea.getArea())
    	alert("vertex count:"+prizearea.getVertexCount())
    	
		prizearea.enableEditing()
	 	
	 
	}
      
    function initialize() {
      if (GBrowserIsCompatible()) {
        map = new GMap2(document.getElementById("map_canvas"));
        map.setCenter(new GLatLng(37.4419, -122.1419), 13);
        map.disableDragging();
        prizearea = new GPolygon(map.getCenter(),'#0000FF','5','1','#0000FF','0.2');
        map.addOverlay(prizearea);
        prizearea.enableDrawing();
        GEvent.addListener(map, "moveend", function(){whereami(map);});
        geocoder = new GClientGeocoder();
        
      }
    }

    function showAddress(address) {
      if (geocoder) {
        geocoder.getLatLng(
          address,
          function(point) {
            if (!point) {
              alert(address + " not found");
            } else {
              map.setCenter(point, 13);
              var marker = new GMarker(point);
              map.addOverlay(marker);
              marker.openInfoWindowHtml(address);
               prizearea = new GPolygon(map.getCenter(),'#0000FF','5','1','#0000FF','0.2');
        map.addOverlay(prizearea);
        prizearea.enableDrawing(); 
            }
          }
        )
      }
    }
	
    </script>
  </head>

  <body onload="initialize()" onunload="GUnload()">
    <form action="#" onsubmit="showAddress(this.address.value); return false">
      <p>
        <input type="text" size="60" name="address" value="1600 Amphitheatre Pky, Mountain View, CA" />
        <input type="submit" value="Go!" />
      </p>
      <div id="map_canvas" style="width: 500px; height: 300px"></div>
    </form>
    

  <a href="javascript:whereami();"/>Where am i?</a><br>
  <a href="javascript:whereistheprizearea();"/>Where is the prize area?</a>
    
  </body>
  
</html>

