<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>Secret Lab for Prize Creation</title>
  <%= stylesheet_link_tag 'scaffold' %>
  <%= javascript_include_tag :defaults %>	
 <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA6RZP3ZouLBJsRfEv4s3jzhT2yXp_ZAY8_ufC3CFXhHIE1NvwkxT6qAbsBjBmEKqdpIQq_13niSn_-Q" type="text/javascript"></script>

	<script>
    var map = null;
 	var geocoder = null;
 	var prizearea = null;

	function whereami()
   {   
    alert(map.getBounds());
    alert(map.getCenter());  
   }
   
   function doStuffBeforeSubmit()
   {
   var arrTempPrizeArea=new Array();
   for (var x=0;x<prizearea.getVertexCount();x++){
   	var latlng = prizearea.getVertex(x);
 		arrTempPrizeArea.push(latlng.lat()+","+latlng.lng());
		}
		
		strTempGeo = arrTempPrizeArea.join(":")
	 	document.getElementById("prize_prizearea").value = strTempGeo;
	 	document.getElementById("center_lat").value = map.getCenter().lat();
	 	document.getElementById("center_lng").value = map.getCenter().lng();
}
 function whereistheprizearea()
 {
 	//alert(prizearea.getBounds())
 	//alert(prizearea.getArea())
 	alert("vertex count:"+prizearea.getVertexCount())
 	
		prizearea.enableEditing()
	 	
	 
	}
   
 function initialize() {
   if (GBrowserIsCompatible()) {
     map = new GMap2(document.getElementById("map_canvas"));
     map.setCenter(new GLatLng(37.4419, -122.1419), 13);
	map.enableContinuousZoom();
     map.disableDragging();
	map.addControl(GSmallZoomControl());
	//map.GMenuMapTypeControl(true);
     prizearea = new GPolygon(map.getCenter(),'#0000FF','5','1','#0000FF','0.2');
     map.addOverlay(prizearea);
     prizearea.enableDrawing();
     GEvent.addListener(map, "moveend", function(){whereami(map);});
     geocoder = new GClientGeocoder();
     
   }
 }

 function showAddress(address) {
   if (geocoder) {
     geocoder.getLatLng(
       address,
       function(point) {
         if (!point) {
           alert(address + " not found");
         } else {
           map.setCenter(point, 13);
           var marker = new GMarker(point);
           map.addOverlay(marker);
           marker.openInfoWindowHtml(address);
            prizearea = new GPolygon(map.getCenter(),'#0000FF','5','1','#0000FF','0.2');
     map.addOverlay(prizearea);
     prizearea.enableDrawing(); 
         }
       }
     )
   }
 }
	
 </script>

</head>
<body <%=@bodyscript %> class="prizes"onload="initialize()" onunload="GUnload()">
	<div class="topview">
		<div class="topofheader"></div>
		<div class="midofheader"><h1>Prize Lab</h1></div>
		<div class="botmofheader"></div>	
	</div>


<div class="leftview"></div>

<div class="bodyview">
<div class="topbodyview">
	<p style="color: green"><%= flash[:notice] %></p>
	<%= error_messages_for :prize %>
</div>
<div class="midbody"><%= yield %></div>
<div class="botmbodyview"><%= link_to 'Return to Prize List', prizes_path %></div>
</div>

<div class="rightview"></div>

<div class="bottomview">
	<div class="topoffooter"></div>
	<div class="midoffooter"></div>
	<div class="botmoffooter"></div>	
</div>

</body>
</html>
