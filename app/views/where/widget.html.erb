<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title></title>
	 <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	 <!--<%= stylesheet_link_tag 'dashboard' %>-->
	 <%= javascript_include_tag :defaults %>
	 <%= GMap.header(:host=>request.host) %>
	 <%= javascript_include_tag 'gmap', 'ym4r-gm', 'gears_init'%> 
	<script> 
	
	function init()
	{
		// Make sure we have Gears. If not, tell the user.
		if (!window.google || !google.gears)
		{
			if (confirm("This application requires Gears to be installed. Install now?"))
			{
				// Use an absolute URL to allow this to work when run from a local file.
				location.href = "http://code.google.com/apis/gears/install.html";
				return;
			}
		}
		
		document.getElementById("status").innerHTML = 'Getting location...';
	}


	function successCallback(p)
	{
		var address = p.gearsAddress.city + ', '
		+ p.gearsAddress.region + ', '
		+ p.gearsAddress.country + ' ('
		+ p.latitude + ', '
		+ p.longitude + ')';
		
		document.getElementById("status").innerHTML = 'Your address is: ' + address;
		//document.getElementById("locationMap").src = "http://maps.google.com/staticmap?center=<%=@device.lat%>,<%=@device.lng%>&zoom=14&size=<%=@device.screenwidth%>x128&maptype=mobile&markers=<%=@device.lat%>,<%=@device.lng%>,blue&format=png&key=<%=Ym4r::GmPlugin::ApiKey.get(:host=>request.host)%>";
		document.getElementById("locationMap").src = "http://maps.google.com/staticmap?center="+p.latitude+","+p.longitude+"&zoom=14&size=<%=@device.screenwidth%>x128&maptype=mobile&markers="+p.latitude+","+p.longitude+",blue&format=png&key=<%=Ym4r::GmPlugin::ApiKey.get(:host=>request.host)%>";
	}

	function errorCallback(err)
	{
		document.getElementById("status").innerHTML = 'Error retrieving your location: ' + err.message;
	}

	function doLatLng()
	{
		try 
		{
			init();
			var geolocation = google.gears.factory.create('beta.geolocation');
			geolocation.getCurrentPosition(successCallback,errorCallback,{enableHighAccuracy: true,gearsRequestAddress: true });
		}
		catch (e) 
		{
			document.getElementById("status").innerHTML = 'Error using Geolocation API: ' + e.message;
			return;
		}
	}
  	</script>
</head>
<body style="background-color:FFFFFF;font-size:<%=@device.textsize%>" onload="doLatLng()">
	<img src="/images/logo_small.png" align="center">
	<form>
		<p id="status"></p>
		<ul>
		<li>Snoop for Loot</li>
		<li>Sniff for Hints</li>
		<li>Do you know the code word?</li>
		<li>About SuperSecretLabs</li>
		</ul>
		if lat lng is populated....
		Our satellites see you here:
		<img id="locationMap" scr/>
		<%=
		#request.env.each_pair {|key, value| puts "#{key}::#{value}<br><br>" }

		%>
	</form>
</body>
</html>

